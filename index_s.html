<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡å¹»å³¶å¶¼æ¢éšª</title>
    <style>
        /* CSS æ¨£å¼å€ - æ§åˆ¶å¤–è§€ */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            overflow: hidden; /* é˜²æ­¢æ²å‹• */
        }

        /* === èªè¨€åˆ‡æ›æŒ‰éˆ•æ¨£å¼ (å³ä¸Šè§’) === */
        #lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 50px;
            height: auto;
            z-index: 100;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #lang-switch img {
            width: 100%;
            height: auto;
            display: block;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        #lang-switch:active {
            transform: scale(0.9);
        }

        /* === 0. å…¬å¸ç‰‡é ­å‹•ç•«æ¨£å¼ (å½±ç‰‡ç‰ˆ) === */
        #scene-intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 1.0s ease-out;
        }

        /* è¨­å®šç‰‡é ­å½±ç‰‡çš„å¤§å° */
        #intro-video {
            width: 100%;
            max-width: 800px;
            height: auto;
            object-fit: contain;
        }

        /* éš±è—ç”¨çš„è¨­å®š */
        .hidden {
            display: none !important;
        }

        /* === 1. åœ°åœ–é é¢å®¹å™¨ (å‹•æ…‹å½±ç‰‡ç‰ˆ) === */
        #scene-map {
            position: relative;
            width: 100vw;
            height: 100vh;
            /* ä¿ç•™åœ–ç‰‡ç•¶ä½œæœ€åº•å±¤ä¿éšª (é˜²æ­¢é»‘ç•«é¢) */
            background-image: url('map.jpg'); 
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }

        /* åœ°åœ–èƒŒæ™¯å½±ç‰‡ (æ–°å¢) */
        #map-video-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* è®“å½±ç‰‡å¡«æ»¿ï¼Œä¸è®Šå½¢ */
            z-index: 0;        /* æ”¾åœ¨æœ€åº•å±¤ */
        }

        /* é€æ˜æŒ‰éˆ• (Hotspots) è¨­å®š */
        .hotspot {
            position: absolute;
            cursor: pointer;
            z-index: 10; /* â˜…é‡è¦ï¼šç¢ºä¿æŒ‰éˆ•æµ®åœ¨å½±ç‰‡ä¸Šé¢ */
            
            background-color: transparent; /* ç¢ºä¿èƒŒæ™¯å…¨é€æ˜ */
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            
            filter: drop-shadow(0px 0px 5px rgba(255, 255, 255, 0.5));
            border-radius: 50%;
            tap-highlight-color: transparent;
            
            /* å‘¼å¸å‹•ç•« */
            animation: breathe 2s infinite ease-in-out;
        }

        /* === è¨­å®šäº”å€‹å³¶å¶¼çš„æ„Ÿæ‡‰ä½ç½® === */
        #btn-dragon { 
            top: 5%; left: 5%; width: 35%; height: 25%; 
            background-image: url('icon_dragon.png');
        }
        #btn-volcano { 
            top: 18%; right: 5%; width: 35%; height: 25%; 
            background-image: url('icon_volcano.png');
        }
        #btn-park { 
            top: 42%; left: 15%; width: 40%; height: 20%; 
            background-image: url('icon_park.png'); 
        }
        #btn-castle { 
            bottom: 25%; right: 0%; width: 30%; height: 20%; 
            background-image: url('icon_castle.png');
        }
        #btn-temple { 
            bottom: 0%; left: 0%; width: 55%; height: 40%; 
            background-image: url('icon_temple.png');
        }

        /* === 2. éå ´å½±ç‰‡æ’­æ”¾å®¹å™¨ === */
        #scene-video {
            position: absolute; 
            top: 0; 
            left: 0; 
            z-index: 50; /* ç¢ºä¿å®ƒåœ¨æœ€ä¸Šå±¤ */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: #000;
        }
        
        video {
            width: 100%;
            max-height: 100%;
        }

        /* === 3. çµæœé é¢å®¹å™¨ === */
        #scene-result {
            position: relative;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        /* çµæœé çš„å¾ªç’°èƒŒæ™¯å½±ç‰‡ */
        #result-bg-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0; /* æ”¾åœ¨æœ€åº•å±¤ */
        }

        /* åœ–ç‰‡æŒ‰éˆ•å®¹å™¨ */
        .img-btn-container {
            position: relative;
            z-index: 10; /* æ”¾åœ¨æ¯”å½±ç‰‡é«˜çš„å±¤ç´š */
            display: block;
            width: 60%;
            max-width: 300px;
            margin: 10px auto;
            cursor: pointer;
            background: transparent;
            border: none;
            padding: 0;
            text-align: center;
            transition: transform 0.2s;
            text-decoration: none;
        }

        .img-btn-container img {
            width: 100%;
            height: auto;
            display: block;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)); 
        }

        .img-btn-container:hover { transform: scale(1.05); }
        .img-btn-container:active { transform: scale(0.95); }

        /* å‘¼å¸å‹•ç•«é—œéµå½±æ ¼ */
        @keyframes breathe {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); filter: brightness(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="scene-intro">
        <video id="intro-video" src="intro.mp4" muted autoplay playsinline></video>
        <div id="btn-enter" class="img-btn-container hidden" style="position:absolute; bottom:20%;">
             </div>
    </div>

    <div id="lang-switch" onclick="toggleLanguage()">
        <img id="img-lang" src="lang_to_en.png">
    </div>

    <div id="scene-map">
        <video id="map-video-bg" autoplay loop muted playsinline poster="map.jpg">
            <source src="map.mp4" type="video/mp4">
        </video>

        <div class="hotspot" id="btn-park" onclick="playScene('park')"></div>
        <div class="hotspot" id="btn-volcano" onclick="playScene('volcano')"></div>
        <div class="hotspot" id="btn-dragon" onclick="playScene('dragon')"></div>
        <div class="hotspot" id="btn-castle" onclick="playScene('castle')"></div>
        <div class="hotspot" id="btn-temple" onclick="playScene('temple')"></div>
    </div>

    <div id="scene-video" class="hidden">
        <video id="video-player" playsinline webkit-playsinline muted>
            <source src="" type="video/mp4">
        </video>
    </div>

    <div id="scene-result" class="hidden">
        <video id="result-bg-video" loop muted playsinline></video>
        
        <div id="btn-start-game" class="img-btn-container" onclick="goToGame()">
            <img id="img-company" src="btn_company.png" alt="é–‹å§‹éŠæˆ²">
        </div>

        <div onclick="resetMap()" class="img-btn-container">
            <img id="img-back" src="btn_back.png" alt="å›åˆ°åœ°åœ–">
        </div>
    </div>

    <audio id="map-bgm" loop>
        <source src="bgm.mp3" type="audio/mp3">
    </audio>
    
    <script>
       // === ğŸï¸ å„å³¶å¶¼çš„å°éŠæˆ²ç¶²å€è¨­å®š (è·¯æ¨™ç³»çµ±) ===
       const gameLinks = {
           "dragon": "https://videodennischiu-oss.github.io/demon/", 
           "volcano": "https://videodennischiu-oss.github.io/lava/",
           "park": "https://videodennischiu-oss.github.io/HEAVEN/",
           "castle": "https://videodennischiu-oss.github.io/Castle-Treasure/", 
           "temple": "https://www.youtube.com/watch?v=moqws3j2ykI" 
       };

       // === ğŸš€ è·³è½‰åŠŸèƒ½ ===
       function goToGame() {
           const targetUrl = gameLinks[currentIsland];
           if (targetUrl && targetUrl !== "#") {
               window.location.href = targetUrl; // åŸè¦–çª—è·³è½‰
           } else {
               alert("é€™å€‹å³¶å¶¼çš„éŠæˆ²é‚„åœ¨é–‹ç™¼ä¸­ï¼æ•¬è«‹æœŸå¾…ï¼");
           }
       }

        // å–å¾— DOM å…ƒç´ 
        const mapScene = document.getElementById('scene-map');
        const videoScene = document.getElementById('scene-video');
        const resultScene = document.getElementById('scene-result');
        const videoPlayer = document.getElementById('video-player');
        
        // ç”¨ä¾†è¨˜éŒ„ç•¶å‰é¸çš„æ˜¯å“ªå€‹å³¶
        let currentIsland = '';

        // åŠŸèƒ½ï¼šé–‹å§‹æ’­æ”¾æŸå€‹å³¶å¶¼çš„åŠ‡æƒ… (é›™è»Œæ’­æ”¾ç„¡ç¸«ç‰ˆ)
        function playScene(islandName) {
            currentIsland = islandName;
            
            // 1. ç•«é¢è¨­å®šï¼š
            mapScene.classList.add('hidden');       // é—œæ‰åœ°åœ–
            videoScene.classList.remove('hidden'); // æ‰“é–‹éå ´å½±ç‰‡ (å®ƒåœ¨æœ€ä¸Šå±¤)
            resultScene.classList.remove('hidden'); // æ‰“é–‹çµæœå±¤ (è®“å®ƒåœ¨ä¸‹é¢å·å·è·‘)

            // --- A. æ’­æ”¾éå ´å½±ç‰‡ (å‰æ™¯) ---
            const videoPath = `video_${islandName}.mp4`;
            videoPlayer.src = videoPath;
            videoPlayer.load();
            
            // æ­£å¸¸é€Ÿåº¦æ’­æ”¾
            videoPlayer.play().then(() => {
                videoPlayer.playbackRate = 1.0; // ç¢ºä¿é€Ÿåº¦æ­£å¸¸
            }).catch(e => {
                console.log("éå ´å½±ç‰‡æ’­æ”¾å¤±æ•—", e);
                showResult(); // å¤±æ•—å‰‡ç›´æ¥é¡¯ç¤ºçµæœ
            });

            // --- B. åŒæ™‚æ’­æ”¾èƒŒæ™¯å¾ªç’°å½±ç‰‡ (èƒŒæ™¯) ---
            const bgVideo = document.getElementById('result-bg-video');
            if(bgVideo) {
                bgVideo.src = `loop_${islandName}.mp4`;
                bgVideo.play().catch(e => console.log("èƒŒæ™¯å·è·‘å¤±æ•—", e));
            }
        }

        // ç›£è½ï¼šç•¶éå ´å½±ç‰‡æ’­æ”¾çµæŸæ™‚
        videoPlayer.onended = function() {
            showResult();
        };

        // åŠŸèƒ½ï¼šé¡¯ç¤ºçµæœåœ– (æ€é–‹è“‹å­ç‰ˆ)
        function showResult() {
            // åªè¦æŠŠæœ€ä¸Šå±¤çš„éå ´å½±ç‰‡é—œæ‰ï¼Œåº•ä¸‹çš„å¾ªç’°å½±ç‰‡å°±æœƒéœ²å‡ºä¾†
            videoScene.classList.add('hidden');
        }

        // åŠŸèƒ½ï¼šå›åˆ°é¦–é åœ°åœ–
        function resetMap() {
            resultScene.classList.add('hidden');
            videoScene.classList.add('hidden');
            mapScene.classList.remove('hidden');
            
            // 1. æ¸…ç©ºéå ´åŠ‡æƒ…å½±ç‰‡
            videoPlayer.src = "";
            
            // 2. æ¸…ç©ºèƒŒæ™¯å¾ªç’°å½±ç‰‡ (çœé›»)
            const bgVideo = document.getElementById('result-bg-video');
            if(bgVideo) {
                bgVideo.pause();
                bgVideo.src = "";
            }
            currentIsland = '';

            // â˜… 3. ç¢ºä¿åœ°åœ–èƒŒæ™¯å½±ç‰‡ç¹¼çºŒæ’­æ”¾ â˜…
            const mapBg = document.getElementById('map-video-bg');
            if(mapBg && mapBg.paused) {
                mapBg.play().catch(e => console.log("åœ°åœ–èƒŒæ™¯æ¢å¾©æ’­æ”¾"));
            }
        }

        // === ç‰‡é ­å‹•ç•«æ§åˆ¶å€ (æ€¥é€Ÿå•Ÿå‹•ç‰ˆ) ===
        document.addEventListener('DOMContentLoaded', function() {
            
            const introScene = document.getElementById('scene-intro');
            const introVideo = document.getElementById('intro-video');
            const enterBtn = document.getElementById('btn-enter'); 
            
            // 1. å˜—è©¦æ’­æ”¾ç‰‡é ­çš„å‡½æ•¸
            function tryPlayIntro() {
                if (introVideo.readyState >= 3) {
                    introScene.classList.remove('hidden');
                    introVideo.play()
                        .then(() => console.log("ç‰‡é ­æ’­æ”¾æˆåŠŸ"))
                        .catch(e => {
                            if(enterBtn) enterBtn.classList.remove('hidden');
                        });
                } else {
                    introVideo.addEventListener('canplay', function() {
                        introScene.classList.remove('hidden');
                        introVideo.play().catch(e => {
                            if(enterBtn) enterBtn.classList.remove('hidden');
                        });
                    }, { once: true });
                }
            }

            // åŸ·è¡Œå˜—è©¦
            tryPlayIntro();

            // 2. ç¶å®šã€Œé€²å…¥æŒ‰éˆ•ã€(è¬ä¸€è‡ªå‹•æ’­æ”¾å¤±æ•—)
            if(enterBtn) {
                enterBtn.addEventListener('click', function() {
                    enterBtn.classList.add('hidden');
                    introVideo.play();
                });
            }
            
            // 3. é—œéµï¼šç›£è½ç‰‡é ­çµæŸï¼Œå¼·åˆ¶é€²å…¥åœ°åœ–
            introVideo.onended = function() {
                console.log("ç‰‡é ­çµæŸï¼Œé€²å…¥åœ°åœ–");
                introScene.classList.add('hidden');
                mapScene.classList.remove('hidden'); 
                
                // å˜—è©¦å•Ÿå‹•éŸ³æ¨‚
                const bgm = document.getElementById('map-bgm');
                if (bgm && bgm.paused) {
                    bgm.volume = 0.3;
                    bgm.play().catch(e => console.log("ç­‰å¾…äº’å‹•å•Ÿå‹•éŸ³æ¨‚"));
                }
                
                // ç¢ºä¿åœ°åœ–å½±ç‰‡æ’­æ”¾
                const mapBg = document.getElementById('map-video-bg');
                if(mapBg) mapBg.play().catch(e=>{});
            };
        });

        // === èªè¨€åˆ‡æ›æ§åˆ¶ ===
        let currentLang = 'cn'; 
        function toggleLanguage() {
            const companyImg = document.getElementById('img-company');
            const langBtnImg = document.getElementById('img-lang'); 
            const backImg = document.getElementById('img-back');
            
            if (currentLang === 'cn') {
                currentLang = 'en';
                if(companyImg) companyImg.src = 'btn_company_en.png'; 
                if(langBtnImg) langBtnImg.src = 'lang_to_cn.png'; 
                if(backImg) backImg.src = 'btn_back_en.png';
            } else {
                currentLang = 'cn';
                if(companyImg) companyImg.src = 'btn_company.png'; 
                if(langBtnImg) langBtnImg.src = 'lang_to_en.png'; 
                if(backImg) backImg.src = 'btn_back.png';
            }

            // åˆ‡æ›äº”å€‹å³¶å¶¼çš„æŒ‰éˆ•åœ–ç¤º
            const islands = ['dragon', 'volcano', 'park', 'castle', 'temple'];
            islands.forEach(name => {
                const btn = document.getElementById(`btn-${name}`);
                if(btn) {
                    if (currentLang === 'en') {
                        btn.style.backgroundImage = `url('icon_${name}_en.png')`;
                    } else {
                        btn.style.backgroundImage = `url('icon_${name}.png')`;
                    }
                }
            });
        }

        // === éŸ³æ¨‚è§£é– (Safari é›™é‡ä¿éšªç‰ˆ) ===
        function unlockAudio() {
            const bgm = document.getElementById('map-bgm');
            const mapBg = document.getElementById('map-video-bg');
            
            // è§£é–éŸ³æ¨‚
            if (bgm && bgm.paused) {
                bgm.volume = 0.3; 
                bgm.play().then(() => {
                    console.log("èƒŒæ™¯éŸ³æ¨‚å•Ÿå‹•æˆåŠŸ");
                    document.removeEventListener('click', unlockAudio);
                    document.removeEventListener('touchstart', unlockAudio);
                }).catch(e => {});
            }
            
            // é †ä¾¿è§£é–åœ°åœ–å½±ç‰‡(å¦‚æœè¢«æ“‹)
            if(mapBg && mapBg.paused) {
                mapBg.play().catch(e=>{});
            }
        }
        document.addEventListener('click', unlockAudio);
        document.addEventListener('touchstart', unlockAudio);
    </script>
</body>
</html>

